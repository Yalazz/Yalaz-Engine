name: CMake

on:
  push:
    branches: [main, develop]
    paths-ignore:
      - '**.md'
      - 'LICENSE'
      - '.gitignore'
  pull_request:
    branches: [main]

env:
  BUILD_TYPE: Release

jobs:
  # ===========================================
  # LINUX BUILD
  # ===========================================
  linuxbuild:
    name: Linux Build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            cmake \
            ninja-build \
            libvulkan-dev \
            vulkan-tools \
            glslang-tools \
            libx11-dev \
            libxrandr-dev \
            libxinerama-dev \
            libxcursor-dev \
            libxi-dev \
            libwayland-dev \
            libxkbcommon-dev

      - name: Configure CMake
        run: cmake --preset linux-release

      - name: Build
        run: cmake --build build/release --parallel $(nproc)

      - name: Verify Build
        run: |
          echo "Build completed successfully!"
          ls -la bin/Release/

  # ===========================================
  # WINDOWS BUILD
  # ===========================================
  windowsbuild:
    name: Windows Build
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Vulkan SDK
        uses: humbletim/setup-vulkan-sdk@v1.2.0
        with:
          vulkan-query-version: 1.3.275.0
          vulkan-components: Vulkan-Headers, Vulkan-Loader, SPIRV-Tools, Glslang
          vulkan-use-cache: true

      - name: Setup MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Configure CMake
        run: cmake --preset vs2022

      - name: Build
        run: cmake --build build/vs2022 --config Release --parallel

      - name: Verify Build
        run: |
          echo "Build completed successfully!"
          dir bin\Release\

  # ===========================================
  # MACOS BUILD
  # ===========================================
  macosbuild:
    name: macOS Build
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Vulkan SDK
        uses: humbletim/setup-vulkan-sdk@v1.2.0
        with:
          vulkan-query-version: 1.3.275.0
          vulkan-components: Vulkan-Headers, Vulkan-Loader, SPIRV-Tools, Glslang, MoltenVK
          vulkan-use-cache: true

      - name: Install Ninja
        run: brew install ninja

      - name: Configure CMake
        run: cmake --preset macos-release

      - name: Build
        run: cmake --build build/release --parallel $(sysctl -n hw.ncpu)

      - name: Verify Build
        run: |
          echo "Build completed successfully!"
          ls -la bin/Release/
